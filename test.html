<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/html">
<head>
<meta content="Microsoft Word 12 (filtered)" name="Generator"/>
<title>Style A ReadMe</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
<body class="pcalibre2 calibre">
<div class="section">
<div class="calibre3" id="ftn4"></div>
<h1 class="tochead" id="heading_id_2">C   Binary data and GridFS</h1>
<p class="body"><span class="ADP">For</span> <span class="VERB">storing</span> <span class="NOUN">images,</span> <span class="NOUN">thumbnails,</span> <span class="NOUN">audio,</span> <span class="CCONJ">and</span> <span class="ADJ">other</span> <span class="PHRASAL NOUN">binary files,</span> <span class="PHRASAL NOUN">many applications</span> <span class="PHRASAL VERB">rely on</span> <span class="PHRASAL NOUN">the filesystem</span> <span class="ADV">only.</span> <span class="SCONJ">Although</span> <span class="NOUN">filesystems</span> <span class="VERB">provide</span> <span class="PHRASAL NOUN">fast access</span> <span class="ADP">to</span> <span class="NOUN">files,</span> <span class="PHRASAL NOUN">filesystem storage</span> <span class="AUX">can</span> <span class="ADV">also</span> <span class="AUX">can</span> <span class="PHRASAL VERB">lead to</span> <span class="PHRASAL NOUN">organizational chaos.</span> <span class="VERB">Consider</span> <span class="SCONJ">that</span> <span class="PHRASAL NOUN">most filesystems</span> <span class="VERB">limit</span> <span class="PHRASAL NOUN">the number</span> <span class="ADP">of</span> <span class="NOUN">files</span> <span class="ADP">per</span> <span class="NOUN">directory.</span> <span class="SCONJ">If</span> <span class="PRON">you</span> <span class="VERB">have</span> <span class="NOUN">millions</span> <span class="ADP">of</span> <span class="NOUN">files</span> <span class="PART">to</span> <span class="VERB">keep</span> <span class="NOUN">track</span> <span class="ADP">of,</span> <span class="PRON">you</span> <span class="VERB">need</span> <span class="PART">to</span> <span class="VERB">devise</span> <span class="DET">a</span> <span class="NOUN">strategy</span> <span class="ADP">for</span> <span class="VERB">organizing</span> <span class="NOUN">files</span> <span class="ADP">into</span> <span class="PHRASAL NOUN">multiple directories.</span> <span class="DET">Another</span> <span class="NOUN">difficulty</span> <span class="VERB">involves</span> <span class="PROPN">metadata.</span> <span class="SCONJ">Because</span> <span class="PHRASAL NOUN">the file metadata</span> <span class="AUX">is</span> <span class="ADV">still</span> <span class="PHRASAL VERB">stored in</span> <span class="DET">a</span> <span class="NOUN">database,</span> <span class="VERB">performing</span> <span class="DET">an</span> <span class="PHRASAL NOUN">accurate backup</span> <span class="ADP">of</span> <span class="PHRASAL NOUN">the files</span> <span class="CCONJ">and</span> <span class="PRON">their</span> <span class="NOUN">metadata</span> <span class="AUX">can be</span> <span class="PHRASAL ADJ">incredibly complicated.</span> </p>
<p class="body"><span class="ADP">For</span> <span class="PHRASAL NOUN">certain use</span> <span class="NOUN">cases,</span> <span class="PRON">it</span> <span class="AUX">may</span> <span class="VERB">make</span> <span class="NOUN">sense</span> <span class="PART">to</span> <span class="VERB">store</span> <span class="NOUN">files</span> <span class="ADP">in</span> <span class="PHRASAL NOUN">the database</span> <span class="PRON">itself</span> <span class="SCONJ">because</span> <span class="VERB">doing</span> <span class="ADV">so</span> <span class="NOUN">simplifies</span> <span class="VERB">file</span> <span class="NOUN">organization</span> <span class="CCONJ">and</span> <span class="NOUN">backup.</span> <span class="ADP">In</span> <span class="NUM">MongoDB,</span> <span class="PRON">you</span> <span class="AUX">can</span> <span class="VERB">use</span> <span class="DET">the</span> <span class="PROPN">BSON</span> <span class="PHRASAL NOUN">binary type</span> <span class="PART">to</span> <span class="VERB">store</span> <span class="DET">any</span> <span class="NOUN">kind</span> <span class="ADP">of</span> <span class="PHRASAL NOUN">binary data.</span> <span class="DET">This</span> <span class="PHRASAL NOUN">data type corresponds</span> <span class="ADP">to</span> <span class="PHRASAL NOUN">the RDBMS</span> <span class="PROPN">BLOB</span> <span class="PUNCT">(</span> <span class="ADJ">binary</span> <span class="PHRASAL NOUN">large object</span> <span class="PUNCT">)</span> <span class="NOUN">type,</span> <span class="CCONJ">and</span> <span class="PRON">it’s</span> <span class="PHRASAL NOUN">the basis</span> <span class="ADP">for</span> <span class="NUM">two</span> <span class="NOUN">flavors</span> <span class="ADP">of</span> <span class="PHRASAL NOUN">binary object</span> <span class="NOUN">storage</span> <span class="PHRASAL VERB">provided by</span> <span class="NUM">MongoDB.</span> </p>
<p class="body"><span class="DET">The</span> <span class="ADJ">first</span> <span class="VERB">uses</span> <span class="NUM">one</span> <span class="NOUN">document</span> <span class="ADP">per</span> <span class="NOUN">file</span> <span class="CCONJ">and</span> <span class="AUX">is</span> <span class="ADJ">best</span> <span class="ADP">for</span> <span class="ADJ">smaller</span> <span class="PHRASAL NOUN">binary objects.</span> <span class="SCONJ">If</span> <span class="PRON">you</span> <span class="VERB">need</span> <span class="PART">to</span> <span class="VERB">catalog</span> <span class="DET">a</span> <span class="PHRASAL NOUN">large number</span> <span class="ADP">of</span> <span class="NOUN">thumbnails</span> <span class="CCONJ">or</span> <span class="PHRASAL NOUN">binary MD5s,</span> <span class="VERB">using</span> <span class="PHRASAL NOUN">single-document</span> <span class="PHRASAL NOUN">binary storage</span> <span class="AUX">can</span> <span class="VERB">make</span> <span class="NOUN">life</span> <span class="PHRASAL ADJ">much easier.</span> <span class="ADP">On</span> <span class="DET">the</span> <span class="PHRASAL NOUN">other hand,</span> <span class="PRON">you</span> <span class="AUX">might</span> <span class="VERB">want</span> <span class="PART">to</span> <span class="VERB">store</span> <span class="PHRASAL NOUN">large images</span> <span class="CCONJ">or</span> <span class="PHRASAL NOUN">audio files.</span> <span class="ADP">In</span> <span class="DET">this</span> <span class="NOUN">case,</span> <span class="PROPN">GridFS,</span> <span class="DET">a</span> <span class="PHRASAL NOUN">MongoDB API</span> <span class="ADP">for</span> <span class="VERB">storing</span> <span class="PHRASAL NOUN">binary objects</span> <span class="ADP">of</span> <span class="DET">any</span> <span class="NOUN">size,</span> <span class="AUX">would be</span> <span class="DET">a</span> <span class="PHRASAL NOUN">better choice.</span> <span class="ADP">In</span> <span class="DET">the</span> <span class="ADJ">next</span> <span class="NUM">two</span> <span class="NOUN">sections,</span> <span class="PRON">you’ll</span> <span class="VERB">see</span> <span class="PHRASAL NOUN">complete examples</span> <span class="ADP">of</span> <span class="DET">both</span> <span class="PHRASAL NOUN">storage techniques.</span> </p>
<h2 class="head" id="heading_id_7">C.1   Simple binary storage</h2>
<p class="body"><span class="NOUN">BSON</span> <span class="VERB">includes</span> <span class="DET">a</span> <span class="PHRASAL NOUN">first-class</span> <span class="NOUN">type</span> <span class="ADP">for</span> <span class="PHRASAL NOUN">binary data.</span> <span class="PRON">You</span> <span class="AUX">can</span> <span class="VERB">use</span> <span class="DET">this</span> <span class="NOUN">type</span> <span class="PART">to</span> <span class="VERB">store</span> <span class="PHRASAL NOUN">binary objects</span> <span class="ADV">directly</span> <span class="ADP">inside</span> <span class="PHRASAL NOUN">MongoDB documents.</span> <span class="DET">The</span> <span class="PHRASAL NOUN">only limit</span> <span class="ADP">on</span> <span class="PHRASAL NOUN">object size</span> <span class="AUX">is</span> <span class="PHRASAL NOUN">the document size</span> <span class="NOUN">limit</span> <span class="PRON">itself,</span> <span class="PRON">which</span> <span class="AUX">is</span> <span class="NUM">16</span> <span class="NOUN">MB</span> <span class="SCONJ">since</span> <span class="NUM">MongoDB</span> <span class="PROPN">v2.0.</span> <span class="SCONJ">Because</span> <span class="PHRASAL NOUN">large documents</span> <span class="ADP">like</span> <span class="PRON">this</span> <span class="AUX">can</span> <span class="PHRASAL NOUN">tax system,</span> <span class="PRON">you’re</span> <span class="VERB">encouraged</span> <span class="PART">to</span> <span class="VERB">use</span> <span class="PROPN">GridFS</span> <span class="ADP">for</span> <span class="DET">any</span> <span class="PHRASAL NOUN">binary objects</span> <span class="PRON">you</span> <span class="VERB">want</span> <span class="PART">to</span> <span class="VERB">store</span> <span class="PRON">that</span> <span class="AUX">are</span> <span class="ADJ">larger</span> <span class="ADP">than</span> <span class="NUM">1</span> <span class="NOUN">MB.</span> </p>
<p class="body"><span class="PRON">We’ll</span> <span class="PHRASAL VERB">look at</span> <span class="NUM">two</span> <span class="PHRASAL NOUN">reasonable uses</span> <span class="ADP">of</span> <span class="PHRASAL NOUN">binary object</span> <span class="NOUN">storage</span> <span class="ADP">in</span> <span class="PHRASAL NOUN">single documents.</span> <span class="ADV">First,</span> <span class="PRON">you’ll</span> <span class="VERB">see</span> <span class="SCONJ">how</span> <span class="PART">to</span> <span class="VERB">store</span> <span class="DET">an</span> <span class="PHRASAL NOUN">image thumbnail.</span> <span class="ADV">Then,</span> <span class="PRON">you’ll</span> <span class="VERB">see</span> <span class="SCONJ">how</span> <span class="PART">to</span> <span class="VERB">store</span> <span class="DET">the</span> <span class="VERB">accompanying</span> <span class="PROPN">MD5.</span> </p>
<h3 class="headb" id="heading_id_3">C.1.1   Storing a thumbnail</h3>
<p class="body"><span class="VERB">Imagine</span> <span class="PRON">you</span> <span class="VERB">need</span> <span class="PART">to</span> <span class="VERB">store</span> <span class="DET">a</span> <span class="NOUN">collection</span> <span class="ADP">of</span> <span class="PHRASAL NOUN">image thumbnails.</span> <span class="PHRASAL NOUN">The code</span> <span class="AUX">is</span> <span class="ADJ">straightforward.</span> <span class="ADV">First,</span> <span class="PRON">you</span> <span class="VERB">get</span> <span class="PHRASAL NOUN">the image’s</span> <span class="NOUN">filename,</span> <span class="NUM">canyon-thumb.jpg,</span> <span class="CCONJ">and</span> <span class="ADV">then</span> <span class="VERB">read</span> <span class="PHRASAL NOUN">the data</span> <span class="ADP">into</span> <span class="DET">a</span> <span class="PHRASAL NOUN">local variable.</span> <span class="ADV">Next,</span> <span class="PRON">you</span> <span class="VERB">wrap</span> <span class="DET">the</span> <span class="ADJ">raw</span> <span class="PHRASAL NOUN">binary data</span> <span class="ADP">as</span> <span class="DET">a</span> <span class="PROPN">BSON</span> <span class="PHRASAL NOUN">binary object</span> <span class="VERB">using</span> <span class="DET">the</span> <span class="PROPN">Ruby</span> <span class="NOUN">driver’s</span> <span class="PROPN">BSON::Binary</span> <span class="NOUN">constructor:</span> </p><code class="codebcxspfirst">require 'rubygems'</code> <code class="codebcxspmiddle">require 'mongo'</code> <code class="codebcxspmiddle">image_filename = File.join(File.dirname(__FILE__), "canyon-thumb.jpg")</code> <code class="codebcxspmiddle">image_data = File.open(image_filename).read</code><code class="codebcxsplast">bson_image_data = BSON::Binary.new(image_data)</code>
<p class="body"><span class="PRON">All</span> <span class="PRON">that</span> <span class="VERB">remains</span> <span class="AUX">is</span> <span class="PART">to</span> <span class="VERB">build</span> <span class="DET">a</span> <span class="PHRASAL NOUN">simple document</span> <span class="PART">to</span> <span class="VERB">contain</span> <span class="DET">the</span> <span class="PHRASAL NOUN">binary data</span> <span class="CCONJ">and</span> <span class="ADV">then</span> <span class="PHRASAL VERB">insert it into</span> <span class="PHRASAL NOUN">the database:</span> </p><code class="codebcxspfirst">doc = {"name" =&gt; "monument-thumb.jpg",</code> <code class="codebcxspmiddle">       "data" =&gt; bson_image_data }</code> <code class="codebcxspmiddle">@con = Mongo::Client.new([‘localhost:27017’], :database =&gt; ‘images’)</code> <code class="codebcxspmiddle">@thumbnails = @con[:thumbnails]</code><code class="codebcxsplast">@image_id = @thumbnails.insert_one(doc)</code>
<p class="body"><span class="PART">To</span> <span class="VERB">extract</span> <span class="DET">the</span> <span class="PHRASAL NOUN">binary data,</span> <span class="VERB">fetch</span> <span class="PHRASAL NOUN">the document.</span> <span class="ADP">In</span> <span class="PROPN">Ruby,</span> <span class="DET">the</span> <span class="PHRASAL NOUN">to_s method</span> <span class="NOUN">unpacks</span> <span class="PHRASAL NOUN">the data</span> <span class="ADP">into</span> <span class="DET">a</span> <span class="PHRASAL NOUN">binary string,</span> <span class="CCONJ">and</span> <span class="PRON">you</span> <span class="AUX">can</span> <span class="VERB">use</span> <span class="PRON">this</span> <span class="PART">to</span> <span class="VERB">compare</span> <span class="DET">the</span> <span class="VERB">saved</span> <span class="NOUN">data</span> <span class="ADP">to</span> <span class="DET">the</span> <span class="ADJ">original:</span> </p><code class="codebcxspfirst">@thumbnails.find({"_id" =&gt; @image_id}).each do |doc|</code> <code class="codebcxspmiddle">  if image_data == doc["data"].to_s</code> <code class="codebcxspmiddle">    puts "Stored image is equal to the original file!"</code> <code class="codebcxspmiddle">  end</code><code class="codebcxsplast">end</code>
<p class="body"><span class="SCONJ">If</span> <span class="PRON">you</span> <span class="VERB">run</span> <span class="DET">the</span> <span class="VERB">preceding</span> <span class="NOUN">script,</span> <span class="PRON">you’ll</span> <span class="VERB">see</span> <span class="DET">a</span> <span class="NOUN">message</span> <span class="VERB">indicating</span> <span class="SCONJ">that</span> <span class="PHRASAL NOUN">the two files</span> <span class="AUX">are</span> <span class="ADV">indeed</span> <span class="DET">the</span> <span class="ADJ">same.</span> </p>
<h3 class="headb" id="heading_id_4">C.1.2   Storing an MD5</h3>
<p class="body"><span class="PRON">It’s</span> <span class="ADJ">common</span> <span class="PART">to</span> <span class="VERB">store</span> <span class="DET">a</span> <span class="NOUN">checksum</span> <span class="ADP">as</span> <span class="PHRASAL NOUN">binary data,</span> <span class="CCONJ">and</span> <span class="PRON">this</span> <span class="VERB">marks</span> <span class="DET">another</span> <span class="PHRASAL NOUN">potential use</span> <span class="ADP">of</span> <span class="DET">the</span> <span class="PROPN">BSON</span> <span class="PHRASAL NOUN">binary type.</span> <span class="ADV">Here’s</span> <span class="SCONJ">how</span> <span class="PRON">you</span> <span class="AUX">can</span> <span class="VERB">generate</span> <span class="DET">an</span> <span class="PROPN">MD5</span> <span class="ADP">of</span> <span class="PHRASAL NOUN">the thumbnail</span> <span class="CCONJ">and</span> <span class="PHRASAL NOUN">add it</span> <span class="ADP">to</span> <span class="PHRASAL NOUN">the document</span> <span class="ADV">just</span> <span class="VERB">stored:</span> </p><code class="codebcxspfirst">require 'md5'</code> <code class="codebcxspmiddle">md5 = Digest::MD5.file(image_filename).digest</code> <code class="codebcxspmiddle">bson_md5 = BSON::Binary.new(md5, :md5)</code><code class="codebcxsplast">@thumbnails.update_one({:_id =&gt; @image_id}, {"$set" =&gt; {:md5 =&gt; bson_md5}})</code>
<p class="body"><span class="VERB">Note</span> <span class="SCONJ">that</span> <span class="SCONJ">when</span> <span class="VERB">creating</span> <span class="DET">the</span> <span class="PROPN">BSON</span> <span class="PHRASAL NOUN">binary object,</span> <span class="PRON">you</span> <span class="VERB">tag</span> <span class="PHRASAL NOUN">the data</span> <span class="ADP">with:</span> <span class="NOUN">md5.</span> <span class="PHRASAL NOUN">The subtype</span> <span class="AUX">is</span> <span class="DET">an</span> <span class="PHRASAL NOUN">extra field</span> <span class="ADP">on</span> <span class="DET">the</span> <span class="PROPN">BSON</span> <span class="PHRASAL NOUN">binary type</span> <span class="PRON">that</span> <span class="VERB">indicates</span> <span class="PRON">what</span> <span class="NOUN">kind</span> <span class="ADP">of</span> <span class="PHRASAL NOUN">binary data</span> <span class="AUX">is being</span> <span class="VERB">stored.</span> <span class="DET">This</span> <span class="NOUN">field</span> <span class="AUX">is</span> <span class="PHRASAL ADJ">entirely optional,</span> <span class="ADV">though,</span> <span class="CCONJ">and</span> <span class="VERB">has</span> <span class="DET">no</span> <span class="NOUN">effect</span> <span class="ADP">on</span> <span class="SCONJ">how</span> <span class="PHRASAL NOUN">the database stores</span> <span class="CCONJ">or</span> <span class="PHRASAL NOUN">interprets the</span> <span class="X">data.[5]</span> </p>
<p class="body"><span class="PRON">It’s</span> <span class="ADJ">easy</span> <span class="PART">to</span> <span class="PHRASAL VERB">query for</span> <span class="PHRASAL NOUN">the document</span> <span class="ADV">just</span> <span class="VERB">stored,</span> <span class="CCONJ">but</span> <span class="AUX">do</span> <span class="VERB">notice</span> <span class="SCONJ">that</span> <span class="PRON">you</span> <span class="VERB">exclude</span> <span class="PHRASAL NOUN">the data field</span> <span class="PART">to</span> <span class="VERB">keep</span> <span class="PHRASAL NOUN">the return document</span> <span class="ADJ">small</span> <span class="CCONJ">and</span> <span class="ADJ">readable:</span> </p><code class="codebcxspfirst">&gt; use images</code> <code class="codebcxspmiddle">&gt; db.thumbnails.findOne({}, {data: 0})</code> <code class="codebcxspmiddle">{</code> <code class="codebcxspmiddle">  "_id" : ObjectId("4d608614238d3b4ade000001"),</code> <code class="codebcxspmiddle">  "md5" : BinData(5,"K1ud3EUjT49wdMdkOGjbDg=="),</code> <code class="codebcxspmiddle">  "name" : "monument-thumb.jpg"</code><code class="codebcxsplast">}</code>
<p class="body"><span class="VERB">See</span> <span class="SCONJ">that</span> <span class="DET">the</span> <span class="PROPN">MD5</span> <span class="NOUN">field</span> <span class="AUX">is</span> <span class="ADV">clearly</span> <span class="PHRASAL VERB">marked as</span> <span class="PHRASAL NOUN">binary data</span> <span class="PUNCT">–</span> <span class="NOUN">briefly</span> <span class="PHRASAL VERB">mentioned in</span> <span class="PROPN">Table</span> <span class="NUM">5.6</span> <span class="PUNCT">–,</span> <span class="ADP">with</span> <span class="PHRASAL NOUN">the subtype</span> <span class="CCONJ">and</span> <span class="PHRASAL NOUN">raw payload.</span> <span class="PHRASAL VERB">Have in</span> <span class="NOUN">mind</span> <span class="SCONJ">that</span> <span class="NOUN">MongoDB</span> <span class="VERB">sorts</span> <span class="PROPN">BinData</span> <span class="ADV">first</span> <span class="ADP">by</span> <span class="PHRASAL NOUN">the length</span> <span class="CCONJ">or</span> <span class="NOUN">size</span> <span class="ADP">of</span> <span class="PHRASAL NOUN">the data,</span> <span class="ADJ">second</span> <span class="ADP">by</span> <span class="DET">the</span> <span class="PROPN">BSON</span> <span class="NUM">one-byte</span> <span class="NOUN">subtype</span> <span class="CCONJ">and</span> <span class="PUNCT">,</span> <span class="ADJ">last,</span> <span class="ADP">by</span> <span class="PHRASAL NOUN">the data,</span> <span class="VERB">performing</span> <span class="DET">a</span> <span class="PHRASAL NOUN">byte-by</span> <span class="PUNCT">-</span> <span class="PHRASAL NOUN">byte comparison.</span> </p>
<h2 class="head" id="heading_id_8">C.2   GridFS</h2>
<p class="body"><span class="PROPN">GridFS</span> <span class="AUX">is</span> <span class="DET">a</span> <span class="NOUN">convention</span> <span class="ADP">for</span> <span class="VERB">storing</span> <span class="NOUN">files</span> <span class="ADP">of</span> <span class="PHRASAL NOUN">arbitrary size</span> <span class="ADP">in</span> <span class="NOUN">MongoDB.</span> <span class="DET">The</span> <span class="PROPN">GridFS</span> <span class="NOUN">specification</span> <span class="AUX">is</span> <span class="PHRASAL VERB">implemented by</span> <span class="DET">all</span> <span class="DET">the</span> <span class="PHRASAL NOUN">official drivers</span> <span class="CCONJ">and</span> <span class="ADP">by</span> <span class="NOUN">MongoDB’s</span> <span class="PHRASAL NOUN">mongofiles tool,</span> <span class="VERB">ensuring</span> <span class="PHRASAL NOUN">consistent access</span> <span class="ADP">across</span> <span class="NOUN">platforms.</span> <span class="PROPN">GridFS</span> <span class="AUX">is</span> <span class="ADJ">useful</span> <span class="ADP">for</span> <span class="VERB">storing</span> <span class="ADJ">large</span> <span class="PHRASAL NOUN">binary objects</span> <span class="ADP">in</span> <span class="PHRASAL NOUN">the database.</span> <span class="PRON">It’s</span> <span class="PHRASAL ADJ">frequently fast</span> <span class="ADV">enough</span> <span class="PART">to</span> <span class="VERB">serve</span> <span class="DET">these</span> <span class="NOUN">objects</span> <span class="ADV">as</span> <span class="ADV">well,</span> <span class="CCONJ">and</span> <span class="PHRASAL NOUN">the storage method</span> <span class="AUX">is</span> <span class="ADJ">conducive</span> <span class="ADP">to</span> <span class="NOUN">streaming.</span> </p>
<p class="body"><span class="PHRASAL NOUN">The term</span> <span class="PROPN">GridFS</span> <span class="AUX">may</span> <span class="PHRASAL VERB">lead to</span> <span class="NOUN">confusion,</span> <span class="ADV">so</span> <span class="NUM">two</span> <span class="NOUN">clarifications</span> <span class="AUX">are</span> <span class="ADJ">worth</span> <span class="VERB">making</span> <span class="NOUN">right</span> <span class="ADP">off</span> <span class="PHRASAL NOUN">the bat.</span> <span class="DET">The</span> <span class="ADJ">first</span> <span class="AUX">is</span> <span class="SCONJ">that</span> <span class="PROPN">GridFS</span> <span class="AUX">isn’t</span> <span class="DET">an</span> <span class="PHRASAL NOUN">intrinsic feature</span> <span class="ADP">of</span> <span class="NOUN">MongoDB.</span> <span class="SCONJ">As</span> <span class="VERB">mentioned,</span> <span class="PRON">it’s</span> <span class="DET">a</span> <span class="NOUN">convention</span> <span class="PRON">that</span> <span class="DET">all</span> <span class="DET">the</span> <span class="PHRASAL NOUN">official drivers</span> <span class="PUNCT">(</span> <span class="CCONJ">and</span> <span class="DET">some</span> <span class="NOUN">tools</span> <span class="PUNCT">)</span> <span class="VERB">use</span> <span class="PART">to</span> <span class="VERB">manage</span> <span class="ADJ">large</span> <span class="PHRASAL NOUN">binary objects</span> <span class="ADP">in</span> <span class="PHRASAL NOUN">the database.</span> <span class="ADV">Second,</span> <span class="PRON">it’s</span> <span class="ADJ">important</span> <span class="PART">to</span> <span class="VERB">clarify</span> <span class="SCONJ">that</span> <span class="PROPN">GridFS</span> <span class="AUX">doesn’t</span> <span class="VERB">have</span> <span class="DET">the</span> <span class="PHRASAL NOUN">rich semantics</span> <span class="ADP">of</span> <span class="ADJ">bona</span> <span class="PHRASAL NOUN">fide filesystems.</span> <span class="ADP">For</span> <span class="NOUN">instance,</span> <span class="PRON">there’s</span> <span class="DET">no</span> <span class="NOUN">protocol</span> <span class="ADP">for</span> <span class="NOUN">locking</span> <span class="CCONJ">and</span> <span class="NOUN">concurrency,</span> <span class="CCONJ">and</span> <span class="PRON">this</span> <span class="VERB">limits</span> <span class="DET">the</span> <span class="PROPN">GridFS</span> <span class="NOUN">interface</span> <span class="ADP">to</span> <span class="PHRASAL NOUN">simple put,</span> <span class="VERB">get,</span> <span class="CCONJ">and</span> <span class="PHRASAL NOUN">delete operations.</span> <span class="PRON">This</span> <span class="VERB">means</span> <span class="SCONJ">that</span> <span class="SCONJ">if</span> <span class="PRON">you</span> <span class="VERB">want</span> <span class="PART">to</span> <span class="VERB">update</span> <span class="DET">a</span> <span class="NOUN">file,</span> <span class="PRON">you</span> <span class="VERB">need</span> <span class="PART">to</span> <span class="VERB">delete</span> <span class="PRON">it</span> <span class="CCONJ">and</span> <span class="ADV">then</span> <span class="VERB">put</span> <span class="DET">the</span> <span class="PHRASAL NOUN">new version.</span> </p>
<p class="body"><span class="PROPN">GridFS</span> <span class="PHRASAL VERB">works by</span> <span class="VERB">dividing</span> <span class="DET">a</span> <span class="PHRASAL NOUN">large file</span> <span class="ADP">into</span> <span class="ADJ">small,</span> <span class="NUM">255</span> <span class="PROPN">KB</span> <span class="VERB">chunks</span> <span class="CCONJ">and</span> <span class="ADV">then</span> <span class="VERB">storing</span> <span class="DET">each</span> <span class="NOUN">chunk</span> <span class="ADP">as</span> <span class="DET">a</span> <span class="PHRASAL NOUN">separate document</span> <span class="PUNCT">–</span> <span class="NOUN">versions</span> <span class="ADV">prior</span> <span class="ADP">to</span> <span class="NOUN">MongoDB</span> <span class="PROPN">v2.4.10</span> <span class="VERB">use</span> <span class="NUM">256</span> <span class="PROPN">KB</span> <span class="NOUN">chunks.</span> <span class="ADP">By</span> <span class="NOUN">default,</span> <span class="DET">these</span> <span class="NOUN">chunks</span> <span class="AUX">are</span> <span class="PHRASAL VERB">stored in</span> <span class="DET">a</span> <span class="NOUN">collection</span> <span class="VERB">called</span> <span class="NOUN">fs.chunks.</span> <span class="SCONJ">Once</span> <span class="PHRASAL NOUN">the chunks</span> <span class="AUX">are</span> <span class="VERB">written,</span> <span class="PHRASAL NOUN">the file’s</span> <span class="PROPN">metadata</span> <span class="AUX">is</span> <span class="PHRASAL VERB">stored in</span> <span class="DET">a</span> <span class="PHRASAL NOUN">single document</span> <span class="ADP">in</span> <span class="DET">another</span> <span class="NOUN">collection</span> <span class="VERB">called</span> <span class="NOUN">fs.files.</span> <span class="PROPN">Figure</span> <span class="PROPN">C.1</span> <span class="VERB">contains</span> <span class="DET">a</span> <span class="PHRASAL NOUN">simplistic illustration</span> <span class="ADP">of</span> <span class="DET">this</span> <span class="NOUN">process</span> <span class="PHRASAL VERB">applied to</span> <span class="DET">a</span> <span class="ADJ">theoretical</span> <span class="NUM">1</span> <span class="PHRASAL NOUN">MB file</span> <span class="VERB">called</span> <span class="NOUN">canyon.jpg.</span> <span class="INTJ">Please</span> <span class="VERB">note</span> <span class="SCONJ">that</span> <span class="PHRASAL NOUN">the use</span> <span class="ADP">of</span> <span class="PHRASAL NOUN">the term</span> <span class="SPACE"> </span> <span class="NOUN">chunks</span> <span class="SPACE"> </span> <span class="ADP">in</span> <span class="PHRASAL NOUN">the context</span> <span class="ADP">of</span> <span class="PROPN">GridFS</span> <span class="AUX">is</span> <span class="PART">not</span> <span class="PHRASAL VERB">related to</span> <span class="PHRASAL NOUN">the use</span> <span class="ADP">of</span> <span class="PHRASAL NOUN">the term</span> <span class="SPACE"> </span> <span class="NOUN">chunks</span> <span class="SPACE"> </span> <span class="ADP">in</span> <span class="PHRASAL NOUN">the context</span> <span class="ADP">of</span> <span class="NOUN">sharding.</span> </p>
<p class="figurea"><img alt="" class="calibre2" src="../Images/C_01.png"/><br class="calibrep&gt; &lt;p class=" figureacaption"=""/>Figure C.1 Storing a file with GridFS using 256 KB chunks</p>
<p class="body"><span class="PRON">That</span> <span class="AUX">should be</span> <span class="PHRASAL NOUN">enough theory</span> <span class="PART">to</span> <span class="VERB">use</span> <span class="NOUN">GridFS[6]</span> <span class="PUNCT">.</span> <span class="ADV">Next</span> <span class="PRON">we’ll</span> <span class="VERB">see</span> <span class="PROPN">GridFS</span> <span class="ADP">in</span> <span class="NOUN">practice</span> <span class="ADP">through</span> <span class="DET">the</span> <span class="PROPN">Ruby</span> <span class="PROPN">GridFS</span> <span class="PROPN">API</span> <span class="CCONJ">and</span> <span class="PHRASAL NOUN">the mongofiles utility.</span> </p>
<h3 class="headb" id="heading_id_5">C.2.1   GridFS in Ruby</h3>
<p class="body"><span class="ADV">Earlier</span> <span class="PRON">you</span> <span class="VERB">stored</span> <span class="DET">a</span> <span class="PHRASAL NOUN">small image</span> <span class="NOUN">thumbnail.</span> <span class="PHRASAL NOUN">The thumbnail</span> <span class="PHRASAL VERB">took up</span> <span class="ADV">only</span> <span class="NUM">10</span> <span class="PROPN">KB</span> <span class="CCONJ">and</span> <span class="AUX">was</span> <span class="PHRASAL ADJ">thus ideal</span> <span class="ADP">for</span> <span class="PHRASAL VERB">keeping in</span> <span class="DET">a</span> <span class="PHRASAL NOUN">single document.</span> <span class="DET">The</span> <span class="PHRASAL NOUN">original image</span> <span class="AUX">is</span> <span class="ADV">almost</span> <span class="NUM">2</span> <span class="NOUN">MB</span> <span class="ADP">in</span> <span class="NOUN">size,</span> <span class="CCONJ">and</span> <span class="AUX">is</span> <span class="ADV">therefore</span> <span class="ADV">much</span> <span class="PHRASAL ADJ">more appropriate</span> <span class="ADP">for</span> <span class="PROPN">GridFS</span> <span class="NOUN">storage.</span> <span class="ADV">Here</span> <span class="PRON">you’ll</span> <span class="VERB">store</span> <span class="DET">the</span> <span class="ADJ">original</span> <span class="VERB">using</span> <span class="PROPN">Ruby’s</span> <span class="PROPN">GridFS</span> <span class="PROPN">API.</span> <span class="ADV">First,</span> <span class="PRON">you</span> <span class="PHRASAL VERB">connect to</span> <span class="PHRASAL NOUN">the database</span> <span class="CCONJ">and</span> <span class="ADV">then</span> <span class="VERB">initialize</span> <span class="DET">a</span> <span class="PROPN">Grid</span> <span class="NOUN">object,</span> <span class="PRON">which</span> <span class="VERB">takes</span> <span class="DET">a</span> <span class="NOUN">reference</span> <span class="ADP">to</span> <span class="PHRASAL NOUN">the database</span> <span class="SCONJ">where</span> <span class="DET">the</span> <span class="PROPN">GridFS</span> <span class="NOUN">file</span> <span class="AUX">will be</span> <span class="VERB">stored.</span> </p>
<p class="body"><span class="ADV">Next,</span> <span class="PRON">you</span> <span class="VERB">open</span> <span class="DET">the</span> <span class="PHRASAL NOUN">original image</span> <span class="NOUN">file,</span> <span class="X">canyon.jpg,</span> <span class="ADP">for</span> <span class="VERB">reading.</span> <span class="DET">The</span> <span class="PHRASAL ADJ">most basic</span> <span class="PROPN">GridFS</span> <span class="NOUN">interface</span> <span class="VERB">uses</span> <span class="NOUN">methods</span> <span class="PART">to</span> <span class="VERB">put</span> <span class="CCONJ">and</span> <span class="VERB">get</span> <span class="DET">a</span> <span class="NOUN">file.</span> <span class="ADV">Here</span> <span class="PRON">you</span> <span class="VERB">use</span> <span class="PHRASAL NOUN">the Grid#put method,</span> <span class="PRON">which</span> <span class="VERB">takes</span> <span class="CCONJ">either</span> <span class="DET">a</span> <span class="NOUN">string</span> <span class="ADP">of</span> <span class="PHRASAL NOUN">binary data</span> <span class="CCONJ">or</span> <span class="DET">an</span> <span class="PROPN">IO</span> <span class="NOUN">object,</span> <span class="ADJ">such</span> <span class="ADP">as</span> <span class="DET">a</span> <span class="PHRASAL NOUN">file pointer.</span> <span class="PRON">You</span> <span class="PHRASAL VERB">pass in</span> <span class="PHRASAL NOUN">the file pointer</span> <span class="CCONJ">and</span> <span class="PHRASAL NOUN">the data</span> <span class="AUX">is</span> <span class="PHRASAL VERB">written to</span> <span class="PHRASAL NOUN">the database.</span> </p>
<p class="body"><span class="PHRASAL NOUN">The method</span> <span class="VERB">returns</span> <span class="PHRASAL NOUN">the file’s</span> <span class="PHRASAL NOUN">unique object</span> <span class="PROPN">ID:</span> </p><code class="codebcxspfirst">@con  = Mongo::Client.new([‘localhost:27017’], :database =&gt; ‘images’)</code> <code class="codebcxspmiddle">@images = @con[:images]</code> <code class="codebcxspmiddle">@grid = Mongo::Grid.new(@images)</code> <code class="codebcxspmiddle">filename = File.join(File.dirname(__FILE__), "canyon.jpg")</code> <code class="codebcxspmiddle">file = File.open(filename, "r")</code> <code class="codebcxspmiddle">grid_file = Mongo::Grid::File.new(</code><code class="codebcxsplast">  file.read, :filename =&gt; File.basename(file.path))</code>
<p class="body"><span class="SCONJ">As</span> <span class="VERB">stated,</span> <span class="PROPN">GridFS</span> <span class="VERB">uses</span> <span class="NUM">two</span> <span class="NOUN">collections</span> <span class="ADP">for</span> <span class="VERB">storing</span> <span class="PHRASAL NOUN">file data.</span> <span class="DET">The</span> <span class="ADJ">first,</span> <span class="ADV">normally</span> <span class="VERB">called</span> <span class="NOUN">fs.files,</span> <span class="VERB">keeps</span> <span class="DET">each</span> <span class="NOUN">file’s</span> <span class="NOUN">metadata.</span> <span class="DET">The</span> <span class="PHRASAL NOUN">second collection,</span> <span class="PROPN">fs.chunks,</span> <span class="NOUN">stores</span> <span class="NUM">one</span> <span class="CCONJ">or</span> <span class="PHRASAL NOUN">more chunks</span> <span class="ADP">of</span> <span class="PHRASAL NOUN">binary data</span> <span class="ADP">for</span> <span class="DET">each</span> <span class="NOUN">file.</span> <span class="PHRASAL VERB">Let’s</span> <span class="ADV">briefly</span> <span class="PHRASAL VERB">examine these from</span> <span class="PHRASAL NOUN">the shell.</span> </p>
<p class="body"><span class="PHRASAL VERB">Switch to</span> <span class="PHRASAL NOUN">the images database,</span> <span class="CCONJ">and</span> <span class="NOUN">query</span> <span class="ADP">for</span> <span class="DET">the</span> <span class="PHRASAL NOUN">first entry</span> <span class="ADP">in</span> <span class="PHRASAL NOUN">the fs.files collection.</span> <span class="PRON">You’ll</span> <span class="VERB">see</span> <span class="PHRASAL NOUN">the metadata</span> <span class="ADP">for</span> <span class="PHRASAL NOUN">the file</span> <span class="PRON">you</span> <span class="ADV">just</span> <span class="VERB">stored:</span> </p><code class="codebcxspfirst">&gt; use images</code> <code class="codebcxspmiddle">&gt; db.fs.files.findOne()</code> <code class="codebcxspmiddle">{</code> <code class="codebcxspmiddle">  "_id" : ObjectId("4d606588238d3b4471000001"),</code> <code class="codebcxspmiddle">  "filename" : "canyon.jpg",</code> <code class="codebcxspmiddle">  "contentType" : "binary/octet-stream",</code> <code class="codebcxspmiddle">  "length" : 2004828,</code> <code class="codebcxspmiddle">  "chunkSize" : 262144,</code> <code class="codebcxspmiddle">  "uploadDate" : ISODate("2011-02-20T00:51:21.191Z"),</code> <code class="codebcxspmiddle">  "md5" : "9725ad463b646ccbd287be87cb9b1f6e"</code><code class="codebcxsplast">}</code>
<p class="body"><span class="PRON">These</span> <span class="AUX">are</span> <span class="DET">the</span> <span class="ADJ">minimum</span> <span class="VERB">required</span> <span class="NOUN">attributes</span> <span class="ADP">for</span> <span class="DET">every</span> <span class="PROPN">GridFS</span> <span class="NOUN">file.</span> <span class="ADJ">Most</span> <span class="AUX">are</span> <span class="PHRASAL NOUN">self-explanatory</span> <span class="PHRASAL NOUN">self-explanatory.</span> <span class="PRON">You</span> <span class="AUX">can</span> <span class="VERB">see</span> <span class="SCONJ">that</span> <span class="DET">this</span> <span class="NOUN">file</span> <span class="AUX">is</span> <span class="ADV">about</span> <span class="NUM">2</span> <span class="NOUN">MB</span> <span class="CCONJ">and</span> <span class="AUX">is</span> <span class="PHRASAL VERB">divided into</span> <span class="NOUN">chunks</span> <span class="NUM">256</span> <span class="PROPN">KB</span> <span class="ADP">in</span> <span class="NOUN">size.</span> <span class="PRON">You’ll</span> <span class="ADV">also</span> <span class="VERB">notice</span> <span class="DET">an</span> <span class="PROPN">MD5.</span> <span class="DET">The</span> <span class="PROPN">GridFS</span> <span class="NOUN">spec</span> <span class="VERB">requires</span> <span class="DET">a</span> <span class="NOUN">checksum</span> <span class="PART">to</span> <span class="VERB">ensure</span> <span class="SCONJ">that</span> <span class="DET">the</span> <span class="VERB">stored</span> <span class="NOUN">file</span> <span class="AUX">is</span> <span class="DET">the</span> <span class="ADJ">same</span> <span class="ADP">as</span> <span class="PHRASAL NOUN">the original.</span> </p>
<p class="body"><span class="DET">Each</span> <span class="NOUN">chunk</span> <span class="VERB">stores</span> <span class="DET">the</span> <span class="ADJ">object</span> <span class="PROPN">ID</span> <span class="ADP">of</span> <span class="PRON">its</span> <span class="NOUN">file</span> <span class="ADP">in</span> <span class="DET">a</span> <span class="NOUN">field</span> <span class="VERB">called</span> <span class="NOUN">files_id.</span> <span class="ADV">Thus</span> <span class="PRON">you</span> <span class="AUX">can</span> <span class="ADV">easily</span> <span class="VERB">count</span> <span class="PHRASAL NOUN">the number</span> <span class="ADP">of</span> <span class="NOUN">chunks</span> <span class="DET">this</span> <span class="NOUN">file</span> <span class="VERB">uses:</span> </p><code class="codebcxspfirst">&gt; db.fs.chunks.count({"files_id" : ObjectId("4d606588238d3b4471000001")})</code> <code class="codebcxsplast">8</code>
<p class="body"><span class="VERB">Given</span> <span class="PHRASAL NOUN">the chunk size</span> <span class="CCONJ">and</span> <span class="DET">the</span> <span class="PHRASAL NOUN">total file</span> <span class="NOUN">size,</span> <span class="NUM">eight</span> <span class="NOUN">chunks</span> <span class="AUX">is</span> <span class="ADV">exactly</span> <span class="PRON">what</span> <span class="PRON">you</span> <span class="AUX">should</span> <span class="VERB">expect.</span> <span class="PHRASAL NOUN">The contents</span> <span class="ADP">of</span> <span class="PHRASAL NOUN">the chunks</span> <span class="PRON">themselves</span> <span class="AUX">are</span> <span class="ADJ">easy</span> <span class="PART">to</span> <span class="VERB">see,</span> <span class="ADV">too.</span> <span class="ADP">Like</span> <span class="ADV">earlier,</span> <span class="PRON">you’ll</span> <span class="VERB">want</span> <span class="PART">to</span> <span class="VERB">exclude</span> <span class="PHRASAL NOUN">the data</span> <span class="PART">to</span> <span class="VERB">keep</span> <span class="PHRASAL NOUN">the output</span> <span class="ADJ">readable.</span> <span class="DET">This</span> <span class="NOUN">query</span> <span class="VERB">returns</span> <span class="DET">the</span> <span class="ADJ">first</span> <span class="ADP">of</span> <span class="PHRASAL NOUN">the eight chunks,</span> <span class="SCONJ">as</span> <span class="PHRASAL VERB">indicated by</span> <span class="PHRASAL NOUN">the value</span> <span class="ADP">of</span> <span class="NUM">n:</span> </p><code class="codebcxspfirst">&gt; db.fs.chunks.findOne({files_id: ObjectId("4d606588238d3b4471000001")},</code> <code class="codebcxspmiddle">          {data: 0})</code> <code class="codebcxspmiddle">{</code> <code class="codebcxspmiddle">  "_id" : ObjectId("4d606588238d3b4471000002"),</code> <code class="codebcxspmiddle">  "n" : 0,</code> <code class="codebcxspmiddle">  "files_id" : ObjectId("4d606588238d3b4471000001")</code><code class="codebcxsplast">}</code>
<p class="body"><span class="VERB">Reading</span> <span class="PROPN">GridFS</span> <span class="NOUN">files</span> <span class="AUX">is</span> <span class="PHRASAL ADJ">as easy</span> <span class="ADP">as</span> <span class="VERB">writing</span> <span class="PRON">them.</span> <span class="ADP">In</span> <span class="DET">the</span> <span class="PHRASAL NOUN">following example,</span> <span class="PRON">you</span> <span class="VERB">use</span> <span class="PROPN">Grid#get</span> <span class="PART">to</span> <span class="VERB">return</span> <span class="DET">an</span> <span class="PROPN">IO-like</span> <span class="PROPN">GridIO</span> <span class="NOUN">object</span> <span class="VERB">representing</span> <span class="PHRASAL NOUN">the file.</span> <span class="PRON">You</span> <span class="AUX">can</span> <span class="ADV">then</span> <span class="VERB">stream</span> <span class="DET">the</span> <span class="PROPN">GridFS</span> <span class="NOUN">file</span> <span class="ADV">back</span> <span class="ADP">to</span> <span class="PHRASAL NOUN">the filesystem.</span> <span class="ADV">Here,</span> <span class="PRON">you</span> <span class="VERB">read</span> <span class="NUM">256</span> <span class="PROPN">KB</span> <span class="ADP">at</span> <span class="DET">a</span> <span class="NOUN">time</span> <span class="PART">to</span> <span class="VERB">write</span> <span class="DET">a</span> <span class="NOUN">copy</span> <span class="ADP">of</span> <span class="DET">the</span> <span class="PHRASAL NOUN">original file:</span> </p><code class="codebcxspfirst">image_io = @grid.get(file_id)</code> <code class="codebcxspmiddle">copy_filename = File.join(File.dirname(__FILE__), "canyon-copy.jpg")</code> <code class="codebcxspmiddle">copy = File.open(copy_filename, "w")</code> <code class="codebcxspmiddle">while !image_io.eof? do</code> <code class="codebcxspmiddle">  copy.write(image_io.read(256 * 1024))</code> <code class="codebcxspmiddle">end</code><code class="codebcxsplast">copy.close</code>
<p class="body"><span class="PRON">You</span> <span class="AUX">can</span> <span class="ADV">then</span> <span class="PHRASAL VERB">verify for</span> <span class="PRON">yourself</span> <span class="SCONJ">that</span> <span class="DET">both</span> <span class="NOUN">files</span> <span class="AUX">are</span> <span class="PHRASAL NOUN">the same:[7]</span> </p><code class="codebcxspfirst">$ diff -s canyon.jpg canyon-copy.jpg</code> <code class="codebcxsplast">Files canyon.jpg and canyon-copy.jpg are identical</code>
<p class="body"><span class="PRON">That’s</span> <span class="PHRASAL NOUN">the basics</span> <span class="ADP">of</span> <span class="VERB">reading</span> <span class="CCONJ">and</span> <span class="VERB">writing</span> <span class="PROPN">GridFS</span> <span class="NOUN">files</span> <span class="ADP">from</span> <span class="DET">a</span> <span class="NOUN">driver.</span> <span class="DET">The</span> <span class="ADJ">various</span> <span class="PROPN">GridFS</span> <span class="NOUN">APIs</span> <span class="VERB">vary</span> <span class="ADV">slightly,</span> <span class="CCONJ">but</span> <span class="ADP">with</span> <span class="DET">the</span> <span class="VERB">foregoing</span> <span class="NOUN">examples</span> <span class="CCONJ">and</span> <span class="DET">the</span> <span class="PHRASAL NOUN">basic knowledge</span> <span class="ADP">of</span> <span class="SCONJ">how</span> <span class="PROPN">GridFS</span> <span class="VERB">works,</span> <span class="PRON">you</span> <span class="AUX">should</span> <span class="VERB">have</span> <span class="DET">no</span> <span class="NOUN">trouble</span> <span class="VERB">making</span> <span class="NOUN">sense</span> <span class="ADP">of</span> <span class="PRON">your</span> <span class="NOUN">driver’s</span> <span class="NOUN">docs.</span> </p>
<h3 class="headb" id="heading_id_6">C.2.2   GridFS with mongofiles</h3>
<p class="body"><span class="PHRASAL NOUN">The MongoDB distribution</span> <span class="VERB">includes</span> <span class="DET">a</span> <span class="PHRASAL NOUN">handy utility</span> <span class="VERB">called</span> <span class="NOUN">mongofiles</span> <span class="ADP">for</span> <span class="NOUN">listing,</span> <span class="VERB">putting,</span> <span class="VERB">getting,</span> <span class="CCONJ">and</span> <span class="VERB">deleting</span> <span class="PROPN">GridFS</span> <span class="NOUN">files</span> <span class="VERB">using</span> <span class="PHRASAL NOUN">the command line.</span> <span class="ADP">For</span> <span class="NOUN">example,</span> <span class="PRON">you</span> <span class="AUX">can</span> <span class="VERB">list</span> <span class="DET">the</span> <span class="PROPN">GridFS</span> <span class="NOUN">files</span> <span class="ADP">in</span> <span class="PHRASAL NOUN">the images database:</span> </p><code class="codebcxspfirst">$ mongofiles -d images list</code> <code class="codebcxspmiddle">connected to: 127.0.0.1</code><code class="codebcxsplast">canyon.jpg  2004828</code>
<p class="body"><span class="PRON">You</span> <span class="AUX">can</span> <span class="ADV">also</span> <span class="ADV">easily</span> <span class="VERB">add</span> <span class="NOUN">files.</span> <span class="ADV">Here’s</span> <span class="SCONJ">how</span> <span class="PRON">you</span> <span class="AUX">can</span> <span class="VERB">add</span> <span class="PHRASAL NOUN">the copy</span> <span class="ADP">of</span> <span class="PHRASAL NOUN">the image</span> <span class="PRON">that</span> <span class="PRON">you</span> <span class="PHRASAL VERB">wrote with</span> <span class="DET">the</span> <span class="PROPN">Ruby</span> <span class="NOUN">script:</span> </p><code class="codebcxspfirst">$ mongofiles -d images put canyon-copy.jpg</code> <code class="codebcxspmiddle">connected to: 127.0.0.1</code> <code class="codebcxspmiddle">added file: { _id: ObjectId('4d61783326758d4e6727228f'),</code> <code class="codebcxspmiddle">              filename: "canyon-copy.jpg",</code> <code class="codebcxspmiddle">              chunkSize: 262144, uploadDate: new Date(1298233395296),</code><code class="codebcxsplast">              md5: "9725ad463b646ccbd287be87cb9b1f6e", length: 2004828 }</code>
<p class="body"><span class="PRON">You</span> <span class="AUX">can</span> <span class="ADV">again</span> <span class="VERB">list</span> <span class="PHRASAL NOUN">the files</span> <span class="PART">to</span> <span class="VERB">verify</span> <span class="SCONJ">that</span> <span class="PHRASAL NOUN">the copy</span> <span class="AUX">was</span> <span class="VERB">written:</span> </p><code class="codebcxspfirst">$ mongofiles -d images list</code> <code class="codebcxspmiddle">connected to: 127.0.0.1</code> <code class="codebcxspmiddle">canyon.jpg  2004828</code><code class="codebcxsplast">canyon-copy.jpg  2004828</code>
<p class="body"><span class="NOUN">mongofiles</span> <span class="VERB">supports</span> <span class="DET">a</span> <span class="NOUN">number</span> <span class="ADP">of</span> <span class="NOUN">options,</span> <span class="CCONJ">and</span> <span class="PRON">you</span> <span class="AUX">can</span> <span class="PHRASAL VERB">view them with</span> <span class="DET">the</span> <span class="PROPN">--help</span> <span class="NOUN">parameter:</span> </p><code class="codebcxspfirst">$ mongofiles --help</code> <code class="codebcxspmiddle">Usage:</code> <code class="codebcxspmiddle">  mongofiles &lt;options&gt; &lt;command&gt; &lt;filename or _id&gt;</code> <code class="codebcxspmiddle"> </code> <code class="codebcxspmiddle">Manipulate gridfs files using the command line.</code> <code class="codebcxspmiddle"> </code> <code class="codebcxspmiddle">Possible commands include:</code> <code class="codebcxspmiddle">    list      - list all files; 'filename' is an optional prefix which listed filenames must begin with</code> <code class="codebcxspmiddle">    search    - search all files; 'filename' is a substring which listed filenames must contain</code> <code class="codebcxspmiddle">    put       - add a file with filename 'filename'</code> <code class="codebcxspmiddle">    get       - get a file with filename 'filename'</code> <code class="codebcxspmiddle">    get_id    - get a file with the given '_id'</code> <code class="codebcxspmiddle">    delete    - delete all files with filename 'filename'</code> <code class="codebcxspmiddle">    delete_id - delete a file with the given '_id'</code><code class="codebcxsplast"> </code>
<p class="body"><span class="VERB">See</span> <span class="PROPN">http://docs.mongodb.org/manual/reference/program/mongofiles/</span> <span class="SPACE"> </span> <span class="ADP">for</span> <span class="PHRASAL NOUN">more information.</span> </p><code class="codebcxspfirst"> </code> <code class="codebcxspmiddle">general options:</code> <code class="codebcxspmiddle">      --help                     print usage</code> <code class="codebcxspmiddle">      --version                  print the tool version and exit</code> <code class="codebcxspmiddle"> </code> <code class="codebcxspmiddle">verbosity options:</code> <code class="codebcxspmiddle">  -v, --verbose      more detailed log output (include multiple times for more</code> <code class="codebcxspmiddle">                     verbosity, e.g. -vvvvv)</code> <code class="codebcxspmiddle">      --quiet        hide all log output</code> <code class="codebcxspmiddle"> </code> <code class="codebcxspmiddle">connection options:</code> <code class="codebcxspmiddle">  -h, --host=         mongodb host to connect to (setname/host1,host2 for</code> <code class="codebcxspmiddle">                      replica sets)</code> <code class="codebcxspmiddle">      --port=         server port (can also use --host hostname:port)</code> <code class="codebcxspmiddle"> </code> <code class="codebcxspmiddle">authentication options:</code> <code class="codebcxspmiddle">  -u, --username=                username for authentication</code> <code class="codebcxspmiddle">  -p, --password=                password for authentication</code> <code class="codebcxspmiddle">      --authenticationDatabase=  database that holds the user's credentials</code> <code class="codebcxspmiddle">      --authenticationMechanism= authentication mechanism to use</code> <code class="codebcxspmiddle"> </code> <code class="codebcxspmiddle">storage options:</code> <code class="codebcxspmiddle">  -d, --db=                      database to use (default is 'test')</code> <code class="codebcxspmiddle">  -l, --local=                   local filename for put|get</code> <code class="codebcxspmiddle">  -t, --type=                    content/MIME type for put (optional)</code> <code class="codebcxspmiddle">  -r, --replace                  remove other files with same name after put</code> <code class="codebcxspmiddle">      --prefix=                  GridFS prefix to use (default is 'fs')</code> <code class="codebcxspmiddle">      --writeConcern=    write concern options e.g. --writeConcern majority,</code> <code class="codebcxspmiddle">                         --writeConcern '{w: 3, wtimeout: 500, fsync: true, j:</code><code class="codebcxsplast">                      true}' (defaults to 'majority')</code>
<div class="calibre3">
<br class="calibre3">
<div class="calibre3" id="ftn5">
<p class="footnote"><span class="X">[</span> <span class="X">5]</span> <span class="PRON">This</span> <span class="AUX">wasn’t</span> <span class="ADV">always</span> <span class="PHRASAL ADJ">technically true.</span> <span class="DET">The</span> <span class="VERB">deprecated</span> <span class="PHRASAL NOUN">default subtype</span> <span class="ADP">of</span> <span class="NUM">2</span> <span class="VERB">indicated</span> <span class="SCONJ">that</span> <span class="DET">the</span> <span class="ADJ">attached</span> <span class="PHRASAL NOUN">binary data</span> <span class="ADV">also</span> <span class="VERB">included</span> <span class="NUM">four</span> <span class="PHRASAL NOUN">extra bytes</span> <span class="PART">to</span> <span class="VERB">indicate</span> <span class="PHRASAL NOUN">the size,</span> <span class="CCONJ">and</span> <span class="PRON">this</span> <span class="AUX">did</span> <span class="VERB">affect</span> <span class="DET">a</span> <span class="PHRASAL NOUN">few database</span> <span class="NOUN">commands.</span> <span class="DET">The</span> <span class="PHRASAL NOUN">current default</span> <span class="NOUN">subtype</span> <span class="AUX">is</span> <span class="NUM">0,</span> <span class="SPACE">  </span> <span class="CCONJ">and</span> <span class="DET">all</span> <span class="NOUN">subtypes</span> <span class="ADV">now</span> <span class="VERB">store</span> <span class="DET">the</span> <span class="PHRASAL NOUN">binary payload</span> <span class="DET">the</span> <span class="PHRASAL NOUN">same way.</span> <span class="NOUN">Subtype</span> <span class="AUX">can</span> <span class="ADV">therefore</span> <span class="AUX">be</span> <span class="PHRASAL VERB">seen as</span> <span class="DET">a</span> <span class="NOUN">kind</span> <span class="ADP">of</span> <span class="PHRASAL NOUN">lightweight tag</span> <span class="PART">to</span> <span class="AUX">be</span> <span class="ADV">optionally</span> <span class="PHRASAL VERB">used by</span> <span class="PHRASAL NOUN">application developers.</span> </p>
</div>
<div class="calibre3" id="ftn6">
<p class="footnote"><span class="X">[</span> <span class="X">6]</span> <span class="PRON">You</span> <span class="AUX">can</span> <span class="VERB">find</span> <span class="PHRASAL NOUN">more information</span> <span class="ADP">about</span> <span class="PROPN">GridFS</span> <span class="ADP">at</span> <span class="NOUN">http://docs.mongodb.org/manual/core/gridfs/</span> <span class="CCONJ">and</span> <span class="ADP">at</span> <span class="NOUN">http://docs.mongodb.org/manual/reference/gridfs/.</span> </p>
</div>
<div class="calibre3" id="ftn7">
<p class="footnote"><span class="X">[</span> <span class="X">7]</span> <span class="DET">This</span> <span class="NOUN">code</span> <span class="VERB">assumes</span> <span class="SCONJ">that</span> <span class="PRON">you</span> <span class="VERB">have</span> <span class="PHRASAL NOUN">the diff utility</span> <span class="VERB">installed.</span> </p>
</div>
</br></div>
</div>
</body>
</html>